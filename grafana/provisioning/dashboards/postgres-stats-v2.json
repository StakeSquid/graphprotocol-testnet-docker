{
  "annotations": {
    "list": [
      {
        "$$hashKey": "object:7",
        "builtIn": 1,
        "datasource": {
          "type": "datasource",
          "uid": "grafana"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 12,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "columns": [],
      "datasource": {
        "type": "postgres",
        "uid": "PA942B37CCFAF5A81"
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 4,
      "links": [],
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 3,
        "desc": true
      },
      "styles": [
        {
          "$$hashKey": "object:128824",
          "alias": "Age",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "pattern": "age",
          "type": "number",
          "unit": "s"
        },
        {
          "$$hashKey": "object:128854",
          "alias": "",
          "align": "left",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": "pid",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        },
        {
          "$$hashKey": "object:10038",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 1,
          "mappingType": 1,
          "pattern": "qid",
          "thresholds": [],
          "type": "string",
          "unit": "short",
          "valueMaps": [
            {
              "$$hashKey": "object:215",
              "text": "ø",
              "value": "ø\\nø\\nblock: ø"
            }
          ]
        },
        {
          "$$hashKey": "object:128825",
          "alias": "Txn Age",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 0,
          "pattern": "txn_age",
          "thresholds": [],
          "type": "number",
          "unit": "s"
        }
      ],
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PA942B37CCFAF5A81"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\nselect regexp_replace(regexp_replace(regexp_replace(coalesce(nullif(application_name,''), 'unknown'),\n                      'query_node_[0-9a-f]+_', 'q-'),\n                      'query_node_high_traffic_[0-9a-f]+_', 'h-'),\n                      'index_node_(customer_)?', 'i-') as client,\n       pid,\n       extract(epoch from age(now(), query_start)) as age,\n       extract(epoch from age(now(), xact_start)) as txn_age,\n       format('%s'||chr(10)||'%s'||chr(10)||'block: %s', variadic (coalesce((select regexp_matches(query, '^/\\*.*application=''([^'']+)'',route=''([^'']+)''.*action=''([^'']+)''.*\\*/.*$')), array['ø', 'ø', 'ø']))) as qid,\n       regexp_replace(query, '^/\\* controller=''filter''.*? \\*/', '') as query\n  from pg_stat_activity\n where query not like '%grafana ignore%'\n   and state='active'\n   and coalesce(usename, 'none') != 'cloudsqlreplica'\n   and query not like '[[autovacuum]]: %'\norder by query_start desc",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Active Queries",
      "transform": "table",
      "type": "table-old"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PA942B37CCFAF5A81"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "last_vacuum"
            },
            "properties": [
              {
                "id": "unit",
                "value": "time: YYYY-MM-DD"
              },
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "tx_before_wraparound_vacuum"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "tx left"
              },
              {
                "id": "unit",
                "value": "short"
              },
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "table_size"
            },
            "properties": [
              {
                "id": "unit",
                "value": "bytes"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.align"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 10,
        "w": 12,
        "x": 0,
        "y": 12
      },
      "id": 9,
      "links": [],
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": false,
            "displayName": "tx left"
          }
        ]
      },
      "pluginVersion": "9.1.6",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PA942B37CCFAF5A81"
          },
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\nSELECT\n  left(n.nspname || '.' || c.relname, 25) as table,\n  least((SELECT setting::int FROM pg_settings WHERE name = 'autovacuum_freeze_max_age') - age(relfrozenxid), \n        (SELECT setting::int FROM pg_settings WHERE name = 'autovacuum_multixact_freeze_max_age') - mxid_age(relminmxid))\n        tx_before_wraparound_vacuum,\n  greatest(pg_stat_get_last_autovacuum_time(c.oid), pg_stat_get_last_vacuum_time(c.oid)) AS last_vacuum,\n  c.relpages::numeric*8192 as table_size,\n  c.reltuples as table_rows\n  -- age(relfrozenxid) AS xid_age,\n  -- mxid_age(relminmxid) AS mxid_age\nFROM\n  pg_class c, pg_namespace n\nWHERE\n  n.oid = c.relnamespace\n  -- c.relname in ('event_meta_data', 'ethereum_blocks','ens_names','eth_call_cache')\n  and c.relkind in ('r','m')\n  and c.oid > 16384\n  and (SELECT setting::int FROM pg_settings WHERE name = 'autovacuum_freeze_max_age') < age(relfrozenxid)\n  and c.relfrozenxid != 0\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Tables requiring wraparound vacuum",
      "transformations": [
        {
          "id": "merge",
          "options": {
            "reducers": []
          }
        }
      ],
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PA942B37CCFAF5A81"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "filterable": false,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "shard"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 84
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "count"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 75
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "all"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 58
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "assigned"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 86
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 10,
        "w": 4,
        "x": 12,
        "y": 12
      },
      "id": 19,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "9.1.6",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PA942B37CCFAF5A81"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT left(ds.shard, 8) shard, count(ds.id) \"all\", count(a.id) assigned from deployment_schemas ds left outer join subgraphs.subgraph_deployment_assignment a on a.id = ds.id group by 1 order by 1",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Deployments",
      "type": "table"
    },
    {
      "datasource": {
        "uid": "$shard"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "tables_needing_vacuum"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "# tables"
              },
              {
                "id": "unit",
                "value": "none"
              },
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "txns_past"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Txns past"
              },
              {
                "id": "unit",
                "value": "locale"
              },
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "last_vacuum"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Last vacuum"
              },
              {
                "id": "unit",
                "value": "short"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": ""
            },
            "properties": [
              {
                "id": "unit",
                "value": "short"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "# tables"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 82
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Txns past"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 106
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Last vacuum"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 101
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "autovacuum"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 93
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "wraparound"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 83
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 8,
        "x": 16,
        "y": 12
      },
      "id": 11,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "9.1.6",
      "targets": [
        {
          "datasource": {
            "uid": "$shard"
          },
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\nselect count(*) as tables_needing_vacuum,\n       -min(tx_before_wraparound_vacuum) as txns_past,\n       to_char(min(last_vacuum), 'MM-DD hh:mm') as last_vacuum,\n       (select count(*) from pg_stat_activity where query like 'autovacuum: %') as autovacuum,\n       (select count(*) from pg_stat_activity where query like 'autovacuum: %wraparound%') as wraparound\n  from (\n    select oid::regclass::text AS table,\n         (select setting::int\n            from pg_settings\n            where name = 'autovacuum_freeze_max_age') - age(relfrozenxid) as tx_before_wraparound_vacuum,\n       greatest(pg_stat_get_last_autovacuum_time(oid), pg_stat_get_last_vacuum_time(oid)) AS last_vacuum,\n       age(relfrozenxid) AS xid_age,\n       mxid_age(relminmxid) AS mxid_age\n  from pg_class\n where relfrozenxid != 0\n   and oid > 16384\n   and relkind in ('r','m')) a where a.tx_before_wraparound_vacuum < 0;\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Tables needing wraparound vacuum",
      "transformations": [
        {
          "id": "merge",
          "options": {
            "reducers": []
          }
        }
      ],
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PA942B37CCFAF5A81"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "text",
                "value": null
              }
            ]
          },
          "unit": "bytes"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 2,
        "w": 8,
        "x": 16,
        "y": 16
      },
      "id": 23,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.1.6",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PA942B37CCFAF5A81"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "select sum(size) as size from pg_ls_waldir();",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Total WAL size",
      "transformations": [],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PA942B37CCFAF5A81"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "filterable": false,
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "locale"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "unused"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 84
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "unused_entities"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 142
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "new (24h)"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 89
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "total"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 89
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "recorded"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 118
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "assigned"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 87
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 8,
        "x": 16,
        "y": 18
      },
      "id": 17,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "9.1.6",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PA942B37CCFAF5A81"
          },
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\nselect count(*) unused,\n       (select count(*) from unused_deployments where removed_at is null) recorded,\n       (select count(distinct deployment) from subgraphs.subgraph_version where created_at >= extract(epoch from now() - '24h'::interval)) \"new (24h)\",\n       (select count(*) from subgraphs.subgraph_deployment_assignment where node_id like 'index_node_%') as \"assigned\",\n       (select count(*) from deployment_schemas) total\n  from deployment_schemas ds\n where not exists (select 1 from subgraphs.subgraph_deployment_assignment sda where ds.id=sda.id)\n   and not exists (select 1 from subgraphs.subgraph_version v, subgraphs.subgraph s where ds.subgraph = v.deployment and v.id in (s.current_version, s.pending_version))",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Deployment usage",
      "type": "table"
    },
    {
      "columns": [],
      "datasource": {
        "uid": "$shard"
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 22
      },
      "id": 13,
      "showHeader": true,
      "sort": {
        "col": 3,
        "desc": true
      },
      "styles": [
        {
          "$$hashKey": "object:40920",
          "alias": "Table",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "relname",
          "type": "string"
        },
        {
          "$$hashKey": "object:40921",
          "alias": "",
          "align": "right",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 0,
          "pattern": "/n_(live|dead)_tup/",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        },
        {
          "$$hashKey": "object:41243",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "last_vacuum",
          "thresholds": [],
          "type": "string",
          "unit": "dateTimeFromNow"
        },
        {
          "$$hashKey": "object:41351",
          "alias": "",
          "align": "right",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "bloat_factor",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        }
      ],
      "targets": [
        {
          "datasource": {
            "uid": "$shard"
          },
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\nselect u.relname,\n       u.n_live_tup, \n       u.n_dead_tup, \n       u.n_dead_tup::numeric/nullif(u.n_live_tup,0)::numeric as bloat_factor, \n       c.relpages,\n       age(now(), greatest(u.last_autovacuum, u.last_vacuum))::text last_vacuum\n  from pg_stat_user_tables u, pg_class c\n where u.schemaname in ('subgraphs','public')\n   and u.relid = c.oid\n   and u.n_dead_tup > 100",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Bloat Report",
      "transform": "table",
      "type": "table-old"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "PA942B37CCFAF5A81"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byRegexp",
              "options": "/name|id/"
            },
            "properties": [
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "created_at"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeAsIso"
              },
              {
                "id": "decimals",
                "value": 2
              },
              {
                "id": "custom.align",
                "value": "right"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "src"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 79
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "src_subgraph"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 426
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "src_shard"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 97
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "dst"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 73
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "dst_subgraph"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 417
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "dst_shard"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 94
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 24,
        "x": 0,
        "y": 30
      },
      "id": 15,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": false,
            "displayName": "queued_at"
          }
        ]
      },
      "pluginVersion": "9.1.6",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "PA942B37CCFAF5A81"
          },
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\r\nselect ac.src, \r\n       src.subgraph as src_subgraph,\r\n       src.shard as src_shard,\r\n       ac.dst,\r\n       dst.subgraph as dst_subgraph,\r\n       dst.shard as dst_shard,\r\n       ac.queued_at,\r\n       ac.cancelled_at \r\n  from active_copies ac,\r\n       deployment_schemas src,\r\n       deployment_schemas dst\r\n where ac.src = src.id\r\n   and ac.dst = dst.id;\r\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Active grafts",
      "transformations": [
        {
          "id": "merge",
          "options": {
            "reducers": []
          }
        }
      ],
      "type": "table"
    },
    {
      "columns": [],
      "datasource": {
        "uid": "$shard"
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 34
      },
      "id": 7,
      "links": [],
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 4,
        "desc": false
      },
      "styles": [
        {
          "$$hashKey": "object:73307",
          "alias": "Granted",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": "granted",
          "preserveFormat": false,
          "sanitize": false,
          "thresholds": [
            ""
          ],
          "type": "string",
          "unit": "none",
          "valueMaps": [
            {
              "$$hashKey": "object:73337",
              "text": "✓",
              "value": "true"
            },
            {
              "$$hashKey": "object:73338",
              "text": "—",
              "value": "false"
            }
          ]
        },
        {
          "$$hashKey": "object:73308",
          "alias": "Age",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 2,
          "pattern": "age",
          "thresholds": [],
          "type": "number",
          "unit": "s"
        }
      ],
      "targets": [
        {
          "datasource": {
            "uid": "$shard"
          },
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\nSELECT  a.application_name,\n        coalesce(extract(epoch from age(now(), a.xact_start)), 0) as age,\n        l.relation::regclass,\n        l.mode,\n        l.GRANTED::varchar,\n        l.locktype \"Target\"\nFROM pg_stat_activity a\nJOIN pg_locks l ON l.pid = a.pid\nwhere pg_backend_pid() != a.pid\norder by granted asc, age desc;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Active locks",
      "transform": "table",
      "type": "table-old"
    },
    {
      "columns": [],
      "datasource": {
        "uid": "$shard"
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 43
      },
      "id": 5,
      "links": [],
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 4,
        "desc": false
      },
      "styles": [
        {
          "$$hashKey": "object:1904",
          "alias": "Age",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "age",
          "type": "number",
          "unit": "s"
        },
        {
          "$$hashKey": "object:1905",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 2,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "datasource": {
            "uid": "$shard"
          },
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "-- grafana ignore\nselect client_addr,\n       application_name,\n       usename,\n       state,\n       extract(epoch from age(now(), xact_start)) as age\n  from pg_stat_activity\n where query not like '%grafana ignore%'\n   and state like '%idle in transaction%'\norder by query_start desc",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Idle transactions",
      "transform": "table",
      "type": "table-old"
    }
  ],
  "refresh": "",
  "revision": 1,
  "schemaVersion": 37,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "postgres",
          "value": "postgres"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "shard",
        "options": [],
        "query": "postgres",
        "queryValue": "",
        "refresh": 1,
        "regex": "/.*/",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {
          "selected": false,
          "text": "with autovacuum",
          "value": "xautovacuum"
        },
        "datasource": {
          "type": "postgres",
          "uid": "PA942B37CCFAF5A81"
        },
        "definition": "select 'with autovacuum' __text, 'xautovacuum' as __value\nunion all\nselect 'without autovacuum' __text, 'autovacuum' as __value",
        "hide": 0,
        "includeAll": false,
        "label": "Queries",
        "multi": false,
        "name": "autovacuum",
        "options": [],
        "query": "select 'with autovacuum' __text, 'xautovacuum' as __value\nunion all\nselect 'without autovacuum' __text, 'autovacuum' as __value",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      }
    ]
  },
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ],
    "time_options": [
      "5m",
      "15m",
      "1h",
      "6h",
      "12h",
      "24h",
      "2d",
      "7d",
      "30d"
    ]
  },
  "timezone": "",
  "title": "Postgres stats",
  "uid": "Mo6FxoiWz",
  "version": 3,
  "weekStart": ""
}